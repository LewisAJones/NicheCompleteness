---
title: "Estimations of extinct species' climatic niche limited by incomplete spatial sampling"
author:
  - Lewis A. Jones^1^, Alfio A. Chiarenza^1^, Erin E. Saupe^2^, Alexander Farnsworth^3^, Paul J. Valdes^3^, and Sara Varela^1^
  - "*^1^Centro de Investigación Mariña, Grupo de Ecoloxía Animal, Universidade de Vigo, 36310 Vigo, Spain.*"
  - "*^2^Department of Earth Sciences, South Parks Road, Oxford, OX1 3AN, UK.*"
  - "*^3^School of Geographical Sciences and Cabot institute, University of Bristol, Bristol, BS8 1TH, UK.*"
  - "**Author for correspondence**`:` Lewis A. Jones (LewisAlan.Jones@uvigo.es)"
output:
  word_document:
    reference_docx: "template.docx"
bibliography: references.bib
csl: palaeontology.csl
---

# Abstract

Ecological niche modelling is applied broadly in ecology to model a species' niche and map suitable habitat. The approach links species' occurrences with environmental predictors to statistically derive response curves. Although commonly applied to study extant taxa, ecological niche modelling is an emerging method in palaeobiology, providing opportunities to test ecological hypotheses regarding the interaction between extinct taxa and their abiotic environment. However, the extent to which the approach can be applied to fossil data remains unconstrained. The fossil record is inherently incomplete and biased by heterogeneous spatial sampling. Consequently, the complete geographic distribution of a species, and its occupation of environmental space, is often unknown. These limitations can bias niche characterisations, leading to potentially erroneous conclusions about niche dynamics through time. Here, we use a virtual species approach to quantify information loss when using fossil data to estimate species' climatic niches and geographic distributions through time. We focus on the Late Cretaceous fossil record to quantify the completeness of species' niches after sampling virtual species by the 'known' spatial sampling window. Our results suggest niche characterisations are often incomplete and biased towards a limited range of climatic conditions. Consequently, statistically derived response curves can be misleading in some cases, resulting in erroneous predictions of suitable habitat. We suggest...

# Keywords

Ecological niche modelling, niche completeness, niche estimation, fossil record bias, sampling bias

# Introduction

Ecological niche modelling (ENM) is a method broadly applied in ecology to model a species' niche and map suitable habitat. It does so by relating field observations with environmental predictor variables to derive statistical response curves and estimate the distribution of suitable habitat [@soberón2009; @sillero2011]. The method is also commonly known as species distribution modelling, climatic-envelope modelling, habitat suitability modelling, and habitat distribution modelling, and can be applied to study a range of entities, not just species. Whilst different names exist depending on application, the approach has the same intent: identify suitable locations for an entity to exist via identification of environmental requirements [@soberón2009; @sillero2011]. ENM allows ecologists to map species ranges and test a range of ecological and evolutionary hypotheses across space and time. In fact, ENM is now routinely applied to predict the response of species to current global warming and potential future pathways using outputs from climate model simulations [@peterson2002; @sillero2013; @jones2019; @resendebraga2022]. However, while ENM is commonly applied to study extant taxa, it is an emerging method in palaeobiology, and provides opportunity to test ecological hypotheses regarding extinct taxa [e.g. @waterson2016; @chiarenza2019].

The increasing availability of deep-time (pre-Quaternary) Earth System model data has enabled a range of recent ENM studies, which cover the entire Mesozoic and Cenozoic (251.9--0 Ma) [@descombes2015; @waterson2016; @saupe2019; @chiarenza2022; @jones2022]. However, the extent to which the approach can be applied to fossil data remains largely unconstrained. The fossil record is inherently incomplete and biased by heterogeneous spatial sampling [@vilhena2013]. Consequently, the complete geographic distribution of a species, and its occupation of environmental space, is often unknown . These limitations can bias niche characterisations, leading to potentially erroneous conclusions about niche dynamics through time (Refs). Common conceptual framework in ENM considers the existence of four niches: 'fundamental niche' (N~F~), 'potential niche' (N~P~), 'realised niche' (N~R~), and 'occupied niche' (N~O~). The N~F~ being the broadest niche category considers the *n*-dimensional volume in environmental space where a species can maintain a viable population and persist along time [@hutchinson1957]. The NP is considered a subset of the N~F~, and represents the intersection between the N~F~ space and the available environmental conditions within that space, and/or time (Refs). The N~R~ is a further subset of NP, in which species are excluded from their niche due to biotic interactions such as competition [@hutchinson1957]. The N~O~ is a subset of N~R~, in which species distributions are constrained by geographical and historical factors, as well as biotic interactions [@pearson2007]. Here, we postulate a further niche concept, the 'sampled niche' (N~S~). The N~S~ is a subset of the N~O~, in which only a proportion of a species' N~O~ may be recovered due to incomplete sampling. We consider this concept within the context of the fossil record, where species' niches might be incompletely characterized due to limited preservation and incomplete sampling (Ref). However, the issue of incomplete sampling of a species' niche is also pertinent to neontological studies (Ref).

Here, we adopt a simulation approach to quantify the potential incompleteness of species' niches in deep time. Subsequently, we evaluate the impact of niche incompleteness on estimations of species' palaeogeographic range. To do so, we generate 'virtual species' for three Late Cretaceous stages: Santonian (83.6--86.3 Ma), Campanian (72.1--83.6 Ma), and Maastrichtian (66--72.1 Ma), and spatially filter their distribution by the available palaeogeographic sampling window. Using their complete and sampled geographic distribution, we: (1) compare characterisations of virtual species' niches in environmental space; (2) and predictions and test the peformance of two ecological niche modelling algorithms (BIOCLIM and MaxEnt) in their estimation of suitable habitat in geographic space. We hypothesize that: (1) niche completeness is a function of sampling, with greater sampling effort resulting in more complete reconstructions of species' niches; (2) range filling is a function of niche completeness, with species ranges more accurately reconstructed when estimations of species niches are more complete; and (3) ....

![**Figure 1:** Schematic representation of the decomposed niche of a species. The dark blue circle depicts the fundamental niche (N~F~), i.e., the n-dimensional volume in the environmental space where a species can maintain a viable population and persist along time [@hutchinson1957]. The light blue circle depicts the realized niche (N~R~), a subset of the fundamental niche due to niche exclusion by competition [@hutchinson1957]. The green circle depicts the occupied niche (N~O~), a subset of the realized niche, in which species distributions are constrained by geographical and historical factors, as well as biotic interactions [@pearson2007]. The yellow circle depicts the sampled niche (N~S~), which is a subset of the occupied niche, in which only a proportion of a species' occupied niche is recovered due to incomplete sampling. Here, this framework is presented within the context of the fossil record, with species' niches incompletely characterized due to both limited preservation and incomplete sampling. However, the issue of incomplete sampling of a species' niche is also pertinent to neontological studies.](../figures/fig-1.jpg)

# Materials & Methods

## Study area and climate data

We conducted our study at global scale within the terrestrial realm for three Late Cretaceous stages: Santonian (83.6--86.3 Ma), Campanian (72.1--83.6 Ma), and Maastrichtian (66--72.1 Ma). This study period captures the lead up to Earth's most recent mass extinction [@brusatte2015], and has been a focus of previous deep time ecological niche modelling studies [@waterson2016]; @chiarenza2019]. Climatic simulations were carried out for each time interval using the HadCM3BL-M2.1aD model, a version of the HadCM3L coupled atmosphere-ocean general circulation model (AOGCM) [@valdes2017]. The HadCM3L climate model has a horizontal resolution of 2.5° latitude x 3.75° longitude in the atmosphere and ocean, with a vertical resolution of 19 levels in the atmospheric component and 20 levels (5550 m depth) in the oceanic component [@valdes2017]. Critically, this model has seen continued development with recent efforts focused on resolving a known limitation of deep-time palaeoclimate models--the 'cold-pole' paradox--in which simulated temperatures at higher latitudes were cooler than suggested by palaeoclimate proxy records [@lunt2021]. Improvements to the Cloud Condensation Nuclei formulation, cloud droplet effective radius [@kiehl2013], perturbed model parameters [@irvine2012], and a fix to a bug in Rayleigh scattering in the short-wave radiation scheme now produces warmer high latitudes, with minimal impact on the tropics, producing surface temperatures that are closer to proxy evidence [**REF -\> Alex to add**]. Crucially, these changes are not state-dependant and can be applied across the range of warm and cool climates for the Phanerozoic, as well as producing a pre-industrial simulation that fits the observations [**REF -\> Alex to add**]. Significantly, versions of this model have been used in a number of deep time ecological niche modelling applications [@waterson2016; @chiarenza2019; @saupe2019]. For each palaeoclimatic simulation, the model was run for over 7,000 years until each simulation reached equilibrium with both the atmosphere and deep ocean showing no significant trend, as well as less than 0.3 W/m2 energy imbalance at the top of the atmosphere. From these climate simulations, only the last 100 years is used to construct the mean of variables available in the model. In accordance with data from @foster2017, CO[2] concentrations were set to 590 (Santonian), 667 (Campanian), 261 (Maastrichtian) ppmv for climatic simulations. Three stage representative digital elevation models (Santonian, Campanian, and Maastrichtian) from the PALEOMAP project [@scotese2018] were used as the boundary conditions for climate simulations, providing spatially explicit approximations of Late Cretaceous continental configuration, topography, and bathymetry. Similarly, solar luminosity is also time specific for each reconstruction, and calculated following the methods of @gough1981. Furthermore, each simulation uses a modern orbital configuration (procession, obliquity, and eccentricity). For the purposes of this study, climate layers were downscaled to a horizontal resolution of 1º x 1º. Similar to previous simulation studies (e.g. @Saupe_2019), we focus on the maximum and minimum tolerances of species as they are components of the abiotic niche that are most likely sensitive to incomplete characterisation. As such, we calculated the maximum and minimum of temperature and precipitation from palaeoclimatic simulations (on a monthly cell-by-cell basis) to serve as inputs for our virtual-species simulations.

## Virtual species simulations

We simulated 10,000 virtual species for each time interval: Santonian, Campanian, and Maastrichtian (a total of 30,000 species). To do so, we used the function 'generateRandomSp()' from the R package 'virtualspecies' ver. 1.5.1 [@leroy2016] with our palaeoclimatic simulations as input layers. For our simulations, we used the 'response approach', with the response set to gaussian and realistic species set to true. This generated simulated niches for each of our virtual species with varying niche breadths, and respective continuous climatic suitability grids. Subsequently, we transformed continuous outputs to binary suitability grids (presence/absence) by applying a suitability threshold value of 0.5. Using these binary grids of the distribution of suitable habitat, we generated the potential geographic distribution for each of our species. To do so, we randomly sampled a seed cell from all cells considered suitable for each species within the climatic landscape. Subsequently, each species was assigned a dispersal capacity, which described its ability to search neighbouring cells for suitable habitats to colonise within each time step. For our simulations, we allowed two dispersal capacities: (1) poor dispersers, with a maximum search radius of two cells (approximately 200 km at the equator) per time step from all occupied cells, and (2) good dispersers, with a maximum search radius of four cells (approximately 400 km at the equator) per time step from all occupied cells. The search radius for each species, for each time step, was defined by an exponential decay curve based on the species' allocated dispersal capacity. As such, species would often not search for any cell to colonise in a time step. However, they could also occasionally jump several cells, overcoming barriers to their distribution. In each time step, we allowed species to colonise one additional suitable cell within its search radius, which was randomly sampled from available suitable cells. For our dispersal simulations, we allowed 1,000 time steps as an initial 'burn-in' stage, enabling species' distributions to equilibrate with their respective suitable conditions.

## Sampling masks

To test how spatial sampling influences reconstructions of species' abiotic niches, we generated stage-level sampling masks for the Santonian, Campanian, and Maastrichtian. To do so, we downloaded all non-marine fossil collections from the Paleobiology Database (PBDB; <https://paleobiodb.org/>) on the 18th of August 2022. This yielded XXX, XXX, and XXX fossil collections for the Santonian, Campanian, and Maastrichtian, respectively. Using the present-day coordinates of each fossil collection and respective digital elevation model ages (Santonian: 85 Ma; Campanian: 80 Ma; Maastrichtian: 70 Ma), we reconstructed the palaeocoordinates of fossil collections using the PALEOMAP plate rotation model [@scotese2018]. Subsequently, we generated grids at the same horizontal resolution (1º x 1º) as the climate model data and virtual-species simulations. For our sampling grids, a cell was deemed to have been sampled if at least one fossil collection appeared within it, and as such, virtual species occurrences within these cells would be sampled. After rasterization of fossil collections, XXX (Santonian), XXX (Campanian), and XXX (Maastrichtian) cells were designated as cells to sample. Subsequent to gridding, we calculated two metrics for summarising the extent of spatial sampling for each stage: (1) spatial sampling coverage, i.e. the percentage of cells sampled within available cells, and (2) the minimum spanning-tree (MST) length, i.e. the minimum total distance of segments connecting all sampled cells. The MST length was calculated using the spantree() function from R package 'vegan' ver. 2.5--7 [@oksanen2019].

## Niche comparisons

We compared characterizations of virtual species' potential, occupied and sampled niches in environmental space using the procedures implemented in the R package 'ecospat' ver. 3.2.1 [@broennimann2012; @dicola2017]. Ecospat includes a range of tools for modelling and comparing species' realised niches, and is frequently used to compare niche overlap between species (e.g. native and invasive) or niche shift [@lima-ribeiro2017; @sales2017; @jones2019; @ahmad2019; @sillero2022]. The ecospat framework uses an ordination approach to compare environmental values associated with species' occurrences from different locations or different time periods. To do so, site-specific environmental values (e.g. temperature) associated with occurrence records are used to calculate a principal component analyses (PCA). The PCA is computed using a combined dataset of extracted environmental values, with the first two components of the PCA transformed into densities by kernel smoothers. Subsequently, niche quantification analyses (such as niche overlap) are performed. Here, we expand the use of the ecospat framework to compare the potential niche of a species to its occupied niches, and subsequently the occupied niche to its sampled counterpart. We quantified shifts in the estimation of species' niches using two metrics from the ecospat package: (1) niche unfilling and (2) centroid distance. The niche unfilling metric quantifies the proportion of a species' niche which is not occupied by the second species. In this work, niche unfilling is considered equivalent to 'niche incompleteness', which we define as the proportion of a species' niche not observed. The centroid distance metric measures the distance between the centroids of two species' niches, for example, of a native and invasive species. Here, we use the centroid distance metric to demonstrate the shift of a species' characterized niche from its potential, occupied and sampled niche. We conducted our analyses for all species with at least five sampled occurrences, an occurrence threshold required to perform niche quantification analyses in the ecospat package. While this could influence our results, such analyses are not typically performed with less occurrences, meaning that our study is more representative of previous work.

## Geographic predictions and comparisons

To test the impact of niche incompleteness on geographic predictions of species' distributions, we generated ENMs using two algorithms via the R Package 'dismo' ver. 1.3--3 [@hijmans2013]: BIOCLIM [@booth2014] and MaxEnt [@phillips2017] . These algorithms were selected as they exemplify a 'simple' (BIOCLIM) and 'complex' (MaxEnt) approach to modelling species' distributions, and have been frequently applied in ENM studies using the fossil record [@sillero2013; @saupe2014; @soto-centeno2015; @steadman2015; @waterson2016; @jones2022; @chiarenza2022]. Specifically, BIOCLIM is a presence-only approach, which uses a climate-envelope method to estimate species' distributions, in which aspects of climate and species' occurrences are used to estimate suitable conditions [@elith2006; @booth2014]. Conversely, MaxEnt is a presence-background approach, which uses machine learning to estimate suitable environmental combinations for a species under the null expectation that suitability is proportional to availability [@phillips2006; @elith2011]. ENMs were calibrated using the full (ENM~full~) and sampled (ENM~samp~) distribution of all virtual species with at least five sampled occurrences. We opted for this threshold to conform with our niche comparison analyses, but also because ENM is not typically performed with fewer occurrences. While this could bias our results towards stronger agreement between ENMfull and ENMsamp geographic predictions, it ensures that our study is representative of previous work. In addition, similar to previous virtual species studies (e.g. @warren2020), we did not tune each ENM for optimal performance, and implemented both algorithms with their default parameters.

To evaluate whether model predictions can estimate the potential and occupied distribution of a species, we compared geographic differences between the 'known' potential (the initial binary suitability grid) and occupied distribution of virtual species with model predictions from ENM~full~ and ENM~samp~. To do so, we based our assessment on the confusion matrix, and calculated the proportion of true positive, false positive, false negative, and true negative cells between the known distributions (potential and occupied) and predictions (ENM~full~ and ENM~samp~) from models built using both algorithms (BIOCLIM and MaxEnt). However, we note that the proportion of cells that are false positive for BIOCLIM will always be zero as it is a climate-envelope model and cannot overpredict.

![**Figure 2:** A confusion (or error) matrix used to evaluate the predictive accuracy of presence-absence predictions from ecological niche models. Here, true positive refers to the proportion of cells accurately classified as suitable, false positive refers to the proportion of cells inaccurately classified as suitable, false negative refers to the proportion of cells inaccurately classified as unsuitable, and true negative refers to the proportion of cells accurately classified as unsuitable.](../figures/fig-2.jpg)

# Results

## Virtual species and spatial sampling

```{r echo = FALSE, results = 'asis'}
library(knitr)
df <- readRDS("./results/sampling-window/spatial-stats.RDS")
# Assign col names for table
colnames(df) <- c('Interval',
                  'Simulated species (*n*)',
                  'Sampled species (*n*)',
                  'Threshold species (*n*)',
                  'Spatial sampling coverage (%)',
                  'Spatial sampling extent (km)')
kable(df, caption = "**Table 1:** Summary table of virtual species simulations. For each interval, 10,000 virtual species were simulated and subsequently sampled by the available sampling window (i.e., fossil collection sites). Threshold species denotes the number of species with five or more occurrences after sampling. Spatial sampling coverage is the percentage of grid cells (1\u00B0 x 1\u00B0) sampled (containing fossil collections) from available cells within the study area. Spatial sampling extent is the minimum spanning-tree length (i.e., the minimum total distance of segments) connecting all sampled cells.")
```

![**Figure 3:** Available and sampled climatic space for each variable and time interval. (A) Maximum and minimum temperature values available (yellow triangles) and sampled (blue circles) for the Santonian, Campanian, and Maastrichtian. (B) Maximum and minimum precipitation values available (yellow triangles) and sampled (blue points) for the Santonian, Campanian, and Maastrichtian. Note the lack of sampling of climatic extremes.](../figures/fig-3.jpg)

## Niche comparisons

```{r echo = FALSE, results = 'asis'}
library(knitr)
df <- readRDS("./results/ecospat/ecospat-summary.RDS")
# Assign col names for table
colnames(df) <- c('Interval',
                  '*n*',
                  'Metric',
                  'Mean',
                  'Standard deviation',
                  'Max',
                  'Min')
kable(df, caption = "**Table 2:** Summary statistics from niche unfilling (incompleteness) and centroid distance analysis for each time interval. Niche unfilling values indicate the proportion of the estimated niche of a virtual species not characterised after subjecting that species to the spatial sampling window. This may be viewed as the incompleteness of the niche, in which values close to one indicate poor niche characterisation, while values close to zero indicate good niche characterisation. Centroid distance indicates the distance between the centroids of the estimated niches (i.e., simulated versus sampled). The larger this distance, the smaller overlap between the species’ approximated niche. In this table, *n* represents the number of samples avaialble for analysis (>= 5 occurrences).")
```

## Geographic comparisons

# Discussion

## Niche completeness

## Spatial sampling and diversity

## Pooling taxonomic level data

## Model complexity

## Regularization multiplier

## Guidelines

## Limitations

# Conclusions

# Acknowledgements

# Author contributions

LAJ, AAC, SV conceived and designed the project; LAJ performed the analyses; LAJ conducted the interpretation of the data; AF and PJV provided the GCM climate data; LAJ, AAC, EES, AF, and SV contributed to the writing of the manuscript; LAJ produced the figures.

# Competing interests

We declare we have no competing interests.

# Data accessibility

All electronic supplementary material and data have been included as part of the submission. All simulations and analyses were performed in R v. 4.0.3 and are available on GitHub (accessible via: <https://github.com/LewisAJones/NicheCompleteness>). Climate model simulations can be accessed at: <https://www.paleo.bristol.ac.uk/ummodel/scripts/papers/>.

# Funding

LAJ, AAC and SV were funded by the European Research Council under the European Union's Horizon 2020 research and innovation program (grant agreement 947921) as part of the MAPAS project. EES's contribution was supported by XXX... AF's contribution was supported by NERC grant NE/K014757/1 and NE/P013805/1. PJV's contribution was supported by XXX...

# References
